(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{1152:function(e,t,n){Promise.resolve().then(n.bind(n,68157))},68157:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return s}});var i=n(57437),a=n(2265),l=n(52289);function s(){let[e,t]=(0,a.useState)(null),[n,s]=(0,a.useState)(null),[d,o]=(0,a.useState)([]),[r,c]=(0,a.useState)(""),[h,p]=(0,a.useState)(""),[u,y]=(0,a.useState)(null),[x,g]=(0,a.useState)(null),[f,m]=(0,a.useState)(0),S=(0,a.useMemo)(()=>new l.BskyAgent({service:"".concat("https://bsky.social")}),[]),j="http://localhost:8083",w=async()=>{y(null);let e=r.trim();if(!e||!h){y("Please enter your handle and App Password");return}try{var n;await S.login({identifier:e,password:h});let i=await S.getProfile({actor:e}),a=(null===(n=S.session)||void 0===n?void 0:n.did)||i.data.did,l=i.data.handle;t({did:a,handle:l}),p("")}catch(e){console.error(e),y("Login failed. Ensure you use a Bluesky App Password (Settings â†’ App passwords).")}},v=async()=>{if(!n&&e)try{let t=await fetch("".concat("http://localhost:8082","/ready_for_round"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tid:"demo",round:1,did:e.did})});if(!t.ok){let e=await t.text().catch(()=>"");o(n=>["connect error: ".concat(t.status," ").concat(e),...n]),alert("Connect failed: coordinator not reachable (check port 8082)");return}let{ticket:n}=await t.json(),i="".concat("ws://localhost:8081/ws","?ticket=").concat(encodeURIComponent(n)),a=new WebSocket(i);a.onopen=()=>{a.send(JSON.stringify({type:"READY_FOR_ROUND",tid:"demo",round:1}))},a.onmessage=e=>{let t=String(e.data);o(e=>[t,...e].slice(0,50));try{let e=JSON.parse(t);if("ASSIGN"===e.type)g(e.match_id);else if("TURN_START"===e.type){var n;m(null!==(n=e.turn)&&void 0!==n?n:0),e.match_id&&g(e.match_id)}else"MATCH_RESULT"===e.type&&m(0)}catch(e){}},a.onclose=()=>s(null),s(a)}catch(e){console.error(e),alert("Connect failed: browser could not reach coordinator (CORS or port)")}},b=async e=>{if(!n||!x||!f)return;let t=Math.random().toString(36).slice(2);n.send(JSON.stringify({type:"REVEAL",match_id:x,turn:f,move_:e,nonce:t}))};return(0,i.jsxs)("main",{style:{display:"flex",flexDirection:"column",gap:16,padding:24},children:[(0,i.jsx)("h1",{children:"Peace.Zone RPS"}),e?(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{children:["Signed in as: ",(0,i.jsx)("strong",{children:e.handle})," (",e.did,")"]}),(0,i.jsxs)("div",{style:{display:"flex",gap:12,marginTop:12},children:[(0,i.jsx)("button",{style:{padding:12},children:"Register"}),(0,i.jsx)("button",{onClick:v,style:{padding:12},children:"Connect"}),(0,i.jsx)("button",{onClick:async()=>{let t="demo-1",n=Math.random().toString(36).slice(2),i=await fetch("".concat(j,"/commit"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({match_id:t,did:e.did,turn:1,move_:"R",nonce:n})}),{commit:a}=await i.json(),l=await fetch("".concat(j,"/reveal"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({commit:a,match_id:t,did:e.did,turn:1,move_:"R",nonce:n})}),s=await l.json();alert("Reveal valid=".concat(s.valid))},style:{padding:12},children:"Commit/Reveal"}),(0,i.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,i.jsx)("button",{disabled:!n||!x||!f,onClick:()=>b("R"),style:{padding:12},children:"Rock (R)"}),(0,i.jsx)("button",{disabled:!n||!x||!f,onClick:()=>b("P"),style:{padding:12},children:"Paper (P)"}),(0,i.jsx)("button",{disabled:!n||!x||!f,onClick:()=>b("S"),style:{padding:12},children:"Scissors (S)"})]})]})]}):(0,i.jsxs)("div",{style:{display:"flex",gap:12,alignItems:"flex-end",flexWrap:"wrap"},children:[(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,i.jsx)("label",{htmlFor:"handle",children:"Bluesky handle"}),(0,i.jsx)("input",{id:"handle",placeholder:"alice.bsky.social",value:r,onChange:e=>c(e.target.value),style:{padding:10,minWidth:240}})]}),(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,i.jsx)("label",{htmlFor:"apppw",children:"App Password (not your main password)"}),(0,i.jsx)("input",{id:"apppw",type:"password",placeholder:"xxxx-xxxx-xxxx-xxxx",value:h,onChange:e=>p(e.target.value),style:{padding:10,minWidth:240}})]}),(0,i.jsx)("button",{onClick:w,style:{padding:12},children:"Sign in with Bluesky"}),u&&(0,i.jsx)("div",{style:{color:"tomato",width:"100%"},children:u})]}),(0,i.jsxs)("section",{children:[(0,i.jsx)("h2",{children:"Audit"}),(0,i.jsx)("p",{children:"Round anchors and logs will be listed here for public verification."}),!!d.length&&(0,i.jsx)("pre",{style:{whiteSpace:"pre-wrap",background:"#111",color:"#eee",padding:12,borderRadius:6},children:d.join("\n")})]})]})}}},function(e){e.O(0,[684,985,156,971,23,744],function(){return e(e.s=1152)}),_N_E=e.O()}]);