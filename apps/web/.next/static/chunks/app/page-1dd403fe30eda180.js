(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{1152:function(e,t,n){Promise.resolve().then(n.bind(n,68157))},68157:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return a}});var l=n(57437),i=n(2265),s=n(52289);function a(){let[e,t]=(0,i.useState)(null),[n,a]=(0,i.useState)(null),[o,d]=(0,i.useState)([]),[r,c]=(0,i.useState)(""),[u,p]=(0,i.useState)(""),[h,x]=(0,i.useState)(null),[y,f]=(0,i.useState)(null),[g,m]=(0,i.useState)(0),[S,j]=(0,i.useState)(0),[w,v]=(0,i.useState)(0),[b,_]=(0,i.useState)(null),[k,R]=(0,i.useState)(0),[C,T]=(0,i.useState)(""),[O,P]=(0,i.useState)(null),N=(0,i.useMemo)(()=>new s.BskyAgent({service:"".concat("https://bsky.social")}),[]),A="http://localhost:8083";(0,i.useEffect)(()=>{let e=setInterval(()=>{if(!b){R(0);return}R(Math.max(0,Math.ceil((b-Date.now())/1e3)))},300);return()=>clearInterval(e)},[b]);let E=async()=>{x(null);let e=r.trim();if(!e||!u){x("Please enter your handle and App Password");return}try{var n;await N.login({identifier:e,password:u});let l=await N.getProfile({actor:e}),i=(null===(n=N.session)||void 0===n?void 0:n.did)||l.data.did,s=l.data.handle;t({did:i,handle:s}),p("")}catch(e){console.error(e),x("Login failed. Ensure you use a Bluesky App Password (Settings → App passwords).")}},D=async()=>{if(!n&&e)try{let t=await fetch("".concat("http://localhost:8082","/ready_for_round"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tid:"demo",round:1,did:e.did})});if(!t.ok){let e=await t.text().catch(()=>"");d(n=>["connect error: ".concat(t.status," ").concat(e),...n]),alert("Connect failed: coordinator not reachable (check port 8082)");return}let{ticket:n}=await t.json(),l="".concat("ws://localhost:8081/ws","?ticket=").concat(encodeURIComponent(n)),i=new WebSocket(l);i.onopen=()=>{i.send(JSON.stringify({type:"READY_FOR_ROUND",tid:"demo",round:1}))},i.onmessage=e=>{let t=String(e.data);d(e=>[t,...e].slice(0,50));try{let e=JSON.parse(t);if("ASSIGN"===e.type)f(e.match_id);else if("TURN_START"===e.type){var n;m(null!==(n=e.turn)&&void 0!==n?n:0),e.match_id&&f(e.match_id),e.deadline_ms_epoch&&_(Number(e.deadline_ms_epoch))}else"MATCH_RESULT"===e.type?(m(0),_(null)):"TURN_RESULT"===e.type&&("P1"===e.result?j(e=>e+1):"P2"===e.result&&v(e=>e+1),_(null),"DRAW"===e.result?T("Draw"):"P1"===e.result?T("You won this turn"):T("Opponent won this turn"))}catch(e){}},i.onclose=()=>a(null),a(i)}catch(e){console.error(e),alert("Connect failed: browser could not reach coordinator (CORS or port)")}},I=async e=>{if(!n||!y||!g)return;let t=Math.random().toString(36).slice(2);n.send(JSON.stringify({type:"REVEAL",match_id:y,turn:g,move_:e,nonce:t})),P(e)};return(0,l.jsxs)("main",{style:{display:"flex",flexDirection:"column",gap:16,padding:24},children:[(0,l.jsx)("h1",{children:"Peace.Zone RPS"}),e?(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{children:["Signed in as: ",(0,l.jsx)("strong",{children:e.handle})," (",e.did,")"]}),(0,l.jsxs)("div",{style:{display:"flex",gap:12,marginTop:12,alignItems:"center",flexWrap:"wrap"},children:[(0,l.jsx)("button",{style:{padding:12},children:"Register"}),(0,l.jsx)("button",{onClick:D,style:{padding:12},children:"Connect"}),(0,l.jsx)("button",{onClick:()=>{f(null),m(0),j(0),v(0),_(null),R(0),T(""),P(null),null==n||n.close(),a(null),setTimeout(D,100)},style:{padding:12},children:"New match"}),(0,l.jsx)("button",{onClick:async()=>{let t="demo-1",n=Math.random().toString(36).slice(2),l=await fetch("".concat(A,"/commit"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({match_id:t,did:e.did,turn:1,move_:"R",nonce:n})}),{commit:i}=await l.json(),s=await fetch("".concat(A,"/reveal"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({commit:i,match_id:t,did:e.did,turn:1,move_:"R",nonce:n})}),a=await s.json();alert("Reveal valid=".concat(a.valid))},style:{padding:12},children:"Commit/Reveal"}),(0,l.jsxs)("div",{style:{display:"flex",gap:16,alignItems:"center",flexWrap:"wrap"},children:[(0,l.jsxs)("span",{children:["Turn: ",(0,l.jsx)("strong",{children:g||"-"})]}),(0,l.jsxs)("span",{style:{fontSize:22},children:["Time left: ",(0,l.jsxs)("strong",{children:[k,"s"]})]}),(0,l.jsxs)("span",{children:["Score: ",(0,l.jsxs)("strong",{children:["You ",S," – ",w," Opp"]})]}),(0,l.jsx)("button",{disabled:!n||!y||!g,onClick:()=>I("R"),style:{padding:16,fontSize:16},children:"Rock"}),(0,l.jsx)("button",{disabled:!n||!y||!g,onClick:()=>I("P"),style:{padding:16,fontSize:16},children:"Paper"}),(0,l.jsx)("button",{disabled:!n||!y||!g,onClick:()=>I("S"),style:{padding:16,fontSize:16},children:"Scissors"}),!!C&&(0,l.jsxs)("span",{style:{marginLeft:8},children:[C,O?" (you played ".concat(O,")"):""]})]})]})]}):(0,l.jsxs)("div",{style:{display:"flex",gap:12,alignItems:"flex-end",flexWrap:"wrap"},children:[(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,l.jsx)("label",{htmlFor:"handle",children:"Bluesky handle"}),(0,l.jsx)("input",{id:"handle",placeholder:"alice.bsky.social",value:r,onChange:e=>c(e.target.value),style:{padding:10,minWidth:240}})]}),(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,l.jsx)("label",{htmlFor:"apppw",children:"App Password (not your main password)"}),(0,l.jsx)("input",{id:"apppw",type:"password",placeholder:"xxxx-xxxx-xxxx-xxxx",value:u,onChange:e=>p(e.target.value),style:{padding:10,minWidth:240}})]}),(0,l.jsx)("button",{onClick:E,style:{padding:12},children:"Sign in with Bluesky"}),h&&(0,l.jsx)("div",{style:{color:"tomato",width:"100%"},children:h})]}),(0,l.jsxs)("section",{children:[(0,l.jsx)("h2",{children:"Audit"}),(0,l.jsx)("p",{children:"Round anchors and logs will be listed here for public verification."}),!!o.length&&(0,l.jsx)("pre",{style:{whiteSpace:"pre-wrap",background:"#111",color:"#eee",padding:12,borderRadius:6},children:o.join("\n")})]})]})}}},function(e){e.O(0,[684,985,156,971,23,744],function(){return e(e.s=1152)}),_N_E=e.O()}]);